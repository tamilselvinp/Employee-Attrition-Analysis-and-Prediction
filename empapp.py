{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "0e4b17b6-f925-443a-bf3f-7c2d061f59e2",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2025-11-28 16:40:47.559 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.720 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.722 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.828 \n",
      "  \u001b[33m\u001b[1mWarning:\u001b[0m to view this Streamlit app on a browser, run it with the following\n",
      "  command:\n",
      "\n",
      "    streamlit run C:\\Users\\Tamilselvi P\\anaconda3\\Lib\\site-packages\\ipykernel_launcher.py [ARGUMENTS]\n",
      "2025-11-28 16:40:47.829 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.832 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.834 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.838 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.841 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.843 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.846 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.848 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.857 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.860 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.864 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.867 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.871 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-11-28 16:40:47.873 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n"
     ]
    }
   ],
   "source": [
    "import streamlit as st  \n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "from streamlit_option_menu import option_menu\n",
    "import warnings\n",
    "import pickle\n",
    "\n",
    "# Filter warnings\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "# Page Configuration\n",
    "st.set_page_config(page_icon=\"üåê\", page_title=\"Employee Attrition Analysis\", layout=\"wide\")\n",
    "st.title(''':orange[***Welcome to the Employee Attrition Analysis system!***]''')\n",
    "\n",
    "# Upload dataset (CSV or Pickle)\n",
    "uploaded_file = st.file_uploader(\"Upload a CSV or Pickle file\", type=[\"csv\", \"pkl\"])\n",
    "\n",
    "df = None\n",
    "rf = None\n",
    "model_features = None\n",
    "\n",
    "if uploaded_file is not None:\n",
    "    if uploaded_file.name.endswith('.csv'):\n",
    "        df = pd.read_csv(uploaded_file)\n",
    "    elif uploaded_file.name.endswith('.pkl'):\n",
    "        loaded_obj = pd.read_pickle(uploaded_file)\n",
    "        if isinstance(loaded_obj, pd.DataFrame):\n",
    "            df = loaded_obj\n",
    "        elif isinstance(loaded_obj, tuple) and len(loaded_obj) == 2:\n",
    "            rf, model_features = loaded_obj\n",
    "        else:\n",
    "            st.error(\"Invalid Pickle file. It must be a DataFrame or a (model, features) tuple.\")\n",
    "\n",
    "# Set background image (optional)\n",
    "page_bg_img = \"\"\"\n",
    "<style>\n",
    "[data-testid=\"stAppViewContainer\"]{\n",
    "background-image: url(\"\");\n",
    "background-size: cover;\n",
    "}\n",
    "[data-testid=\"stHeader\"]{\n",
    "background-color: rgba(0, 0, 0, 0);\n",
    "}   \n",
    "[data-testid=\"stSidebarContent\"]{\n",
    "background-color: rgba(0, 0, 0, 0);\n",
    "background-size: cover;\n",
    "}\n",
    "</style>\n",
    "\"\"\"\n",
    "st.markdown(page_bg_img, unsafe_allow_html=True)\n",
    "\n",
    "# Sidebar Navigation\n",
    "with st.sidebar:\n",
    "    selected_page = option_menu(\n",
    "        'Employee Attrition Analysis and Prediction', \n",
    "        ['Home', 'Predict Attrition', 'Age vs Employee-Attrition', 'Age Distribution', 'Department vs Employee-Attrition', 'Attrition Analysis'],\n",
    "        icons=['house', 'activity', 'bar-chart', 'person', 'briefcase', 'pie-chart'], \n",
    "        default_index=0,\n",
    "        orientation='vertical',  \n",
    "        styles={\n",
    "            \"container\": {\"padding\": \"3px\", \"background-color\": \"#f0f0f5\"},\n",
    "            \"icon\": {\"color\": \"orange\", \"font-size\": \"20px\"},\n",
    "            \"nav-link\": {\"font-size\": \"16px\", \"text-align\": \"left\", \"margin\": \"3px\", \"--hover-color\": \"#f0f0f5\"},\n",
    "            \"nav-link-selected\": {\"background-color\": \"#ADD8E6\"},\n",
    "        }\n",
    "    )\n",
    "\n",
    "# Home Page\n",
    "if selected_page == 'Home':\n",
    "    if df is not None:\n",
    "        st.write(\"‚úÖ DataFrame loaded successfully!\")\n",
    "        st.write(df.head())\n",
    "    elif rf is not None:\n",
    "        st.write(\"‚úÖ Model loaded successfully and ready for prediction.\")\n",
    "    else:\n",
    "        st.write(\"Please upload a CSV file for analysis or a Pickle model for prediction.\")\n",
    "\n",
    "elif selected_page == \"Predict Attrition\":\n",
    "    if rf is not None and model_features is not None:\n",
    "        st.header(\"Predict Employee Attrition\")\n",
    "        st.markdown(\"### üìã Enter Employee Details\")\n",
    "\n",
    "        # Collect inputs\n",
    "        age = st.slider(\"Age\", 18, 60, 30)\n",
    "        job_satisfaction = st.slider(\"Job Satisfaction (1-4)\", 1, 4, 3)\n",
    "        years_at_company = st.slider(\"Years at Company\", 0, 40, 5)\n",
    "        monthly_income = st.number_input(\"Monthly Income\", min_value=1000, max_value=20000, value=5000)\n",
    "\n",
    "        overtime = st.selectbox(\"OverTime\", [\"Yes\", \"No\"])\n",
    "        department = st.selectbox(\"Department\", [\"Sales\", \"Research & Development\", \"Human Resources\"])\n",
    "        job_role = st.selectbox(\"Job Role\", [\n",
    "            \"Sales Executive\", \"Research Scientist\", \"Laboratory Technician\", \n",
    "            \"Manufacturing Director\", \"Healthcare Representative\", \n",
    "            \"Manager\", \"Sales Representative\", \"Research Director\", \"Human Resources\"])\n",
    "        marital_status = st.selectbox(\"Marital Status\", [\"Single\", \"Married\", \"Divorced\"])\n",
    "        performance_rating = st.selectbox(\"Performance Rating\", [1, 2, 3, 4])\n",
    "\n",
    "        # Build input DataFrame\n",
    "        input_dict = {\n",
    "            'Age': [age],\n",
    "            'JobSatisfaction': [job_satisfaction],\n",
    "            'YearsAtCompany': [years_at_company],\n",
    "            'MonthlyIncome': [monthly_income],\n",
    "            'OverTime': [overtime],  # ‚úÖ keep as string\n",
    "            'Department': [department],\n",
    "            'JobRole': [job_role],\n",
    "            'MaritalStatus': [marital_status],\n",
    "            'PerformanceRating': [performance_rating],\n",
    "        }\n",
    "\n",
    "        input_df = pd.DataFrame(input_dict)\n",
    "\n",
    "        # One-hot encode categorical columns\n",
    "        categorical_cols = ['Department', 'JobRole', 'MaritalStatus', 'OverTime']\n",
    "        input_encoded = pd.get_dummies(input_df, columns=categorical_cols, drop_first=True)  # ‚úÖ match training\n",
    "\n",
    "        # Align input with model features\n",
    "        for col in model_features:\n",
    "            if col not in input_encoded.columns:\n",
    "                input_encoded[col] = 0\n",
    "        input_encoded = input_encoded[model_features]\n",
    "\n",
    "        # Predict\n",
    "        prediction = rf.predict(input_encoded)[0]\n",
    "        proba = rf.predict_proba(input_encoded)[0][1]\n",
    "\n",
    "        # Display result\n",
    "        st.subheader(\"üìä Prediction Result:\")\n",
    "        st.write(f\"**Attrition:** {'Yes' if prediction == 1 else 'No'}\")\n",
    "        st.write(f\"**Probability of Leaving:** {proba:.2%}\")\n",
    "    else:\n",
    "        st.warning(\"Please upload a Pickle model file (with both model and features) to use the prediction feature.\")\n",
    "\n",
    "# Age vs Employee-Attrition\n",
    "elif selected_page == 'Age vs Employee-Attrition':\n",
    "    if df is not None:\n",
    "        st.title(\"Age vs Employee-Attrition Analysis\")\n",
    "        if df['Attrition'].dtype == 'object':\n",
    "            df['Attrition'] = df['Attrition'].map({'Yes': 1, 'No': 0})\n",
    "        fig, ax = plt.subplots()\n",
    "        ax.scatter(df['Age'], df['Attrition'], color='Slateblue', alpha=0.5)\n",
    "        ax.set_xlabel('Age')\n",
    "        ax.set_ylabel('Attrition')\n",
    "        ax.set_title('Age vs Employee-Attrition')\n",
    "        st.pyplot(fig)\n",
    "    else:\n",
    "        st.write(\"Please upload a CSV file to view this chart.\")\n",
    "\n",
    "# Age Distribution\n",
    "elif selected_page == 'Age Distribution':\n",
    "    if df is not None:\n",
    "        st.title(\"Age Distribution Analysis\")\n",
    "        fig, ax = plt.subplots(figsize=(8, 5))\n",
    "        ax.hist(df['Age'], bins=15, color='skyblue', edgecolor='black')\n",
    "        ax.set_xlabel('Age')\n",
    "        ax.set_ylabel('Frequency')\n",
    "        ax.set_title('Age Distribution of Employees')\n",
    "        st.pyplot(fig)\n",
    "    else:\n",
    "        st.write(\"Please upload a CSV file to view this chart.\")\n",
    "\n",
    "# Department vs Employee-Attrition\n",
    "elif selected_page == 'Department vs Employee-Attrition':\n",
    "    if df is not None:\n",
    "        st.title(\"Department vs Employee-Attrition Analysis\")\n",
    "        if df['Attrition'].dtype == 'object':\n",
    "            df['Attrition'] = df['Attrition'].map({'Yes': 1, 'No': 0})\n",
    "        plt.figure(figsize=(10, 6))\n",
    "        sns.barplot(x='Department', y='Attrition', hue='PerformanceRating', data=df, palette='Set2')\n",
    "        plt.title(\"Department vs Employee-Attrition\")\n",
    "        plt.xlabel(\"Department\")\n",
    "        plt.ylabel(\"Attrition\")\n",
    "        st.pyplot(plt)\n",
    "    else:\n",
    "        st.write(\"Please upload a CSV file to view this chart.\")\n",
    "\n",
    "# Attrition Pie Chart\n",
    "elif selected_page == 'Attrition Analysis':\n",
    "    if df is not None:\n",
    "        st.title(\"Attrition Analysis\")\n",
    "        if df['Attrition'].dtype != 'int':\n",
    "            df['Attrition'] = df['Attrition'].map({'Yes': 1, 'No': 0})\n",
    "        attrition_counts = df['Attrition'].value_counts()\n",
    "        labels = ['No', 'Yes']\n",
    "        fig, ax = plt.subplots(figsize=(6, 6))\n",
    "        ax.pie(attrition_counts, labels=labels, autopct='%1.1f%%', startangle=90, colors=['lightblue', 'salmon'])\n",
    "        ax.set_title('Attrition Distribution')\n",
    "        st.pyplot(fig)\n",
    "    else:\n",
    "        st.write(\"Please upload a CSV file to view this chart.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": None,
   "id": "58b5fa61-b994-48eb-bdb3-e7901c594266",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
